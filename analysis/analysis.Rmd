---
title: "Analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Predicting if a suspect is arrested
Predicting if a suspect is arrested is a binary classification problem. In order to get a baseline, we will first consider logistic regression. This has the assumption that the data is independent and identically distributed, which likely is not the case. However, it gives us a baseline against which further analysis can be conducted.

## Imports
```{r}
library(tidyverse)
library(lubridate)
devtools::load_all("../chigcrim/")
```

## Load data
```{r}
df <- load_data(year = 2019, strings_as_factors = FALSE)
```

## Feature selection
Choices:
- Encode the date as the day in the year (1-365) - This doesn't really look good, so perhaps a transformation would be better

- Encode time of day as a float 0-24 (this looks OK from a plot of proportion arrested over time).

- Drop `year` as these are all 2019

- We will drop the `id`s, as it contains unique values

- We drop `case_number`, as it contains almost all unique values

- Drop `primary_type`, `description` and `iucr` code. Keep `fbi_code` as an indicator of crime type.

- Assume `updated_on` is not informative (see EDA)

- X and Y coordinates, latitude and longitude are dropped (a linear relationship does not seem like it would be very useful)

- Community areas will be kept, but other areas (`district`, `beat`, `ward` and `block`) are dropped.

- NAs will be dropped

```{r}
df$fbi_code <- otherise(df$fbi_code, 500)
df$location_description <- otherise(df$location_description, 1000)

remove_features <- c("id", "year", "case_number", "primary_type", "description",
                     "iucr", "updated_on", "latitude", "longitude",
                     "x_coordinate", "y_coordinate", "date",
                     "district", "beat", "ward", "block")

df <- df %>%
  mutate(day = yday(df$date),
         time = hour(df$date) + minute(df$date)/60) %>%
  select(-all_of(remove_features)) %>%
  filter(complete.cases(df))

# Convert to factors
df <- df %>%
  mutate(location_description = as.factor(location_description),
         fbi_code = as.factor(fbi_code),
         community_area = as.factor(community_area))

X <- df %>% select(-arrest)
y <- df$arrest

lr <- LogisticRegression$new()
lr$fit(X, y)
y_hat = lr$predict(X)
```
Calculate proportion classified correctly on the train set:
```{r}
sum(round(y_hat) == df$arrest) / length(y_hat)
```

